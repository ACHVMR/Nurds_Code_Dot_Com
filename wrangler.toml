# ============================================
# Nurds Code - Cloudflare Workers Configuration (Dev-friendly)
# ============================================

name = "nurdscode-api"
main = "workers/index.js"
compatibility_date = "2024-10-30"
workers_dev = true

# Account configuration (optional for local dev)
# account_id can be set for deploy; omit/empty for local
# route only applies in production

# ============================================
# Development Configuration
# ============================================
[dev]
port = 8787
local_protocol = "http"

# ============================================
# D1 Database (Module Registry & Entitlements)
# ============================================
[[d1_databases]]
binding = "DB"
database_name = "nurdscode-db"
database_id = "e69e006b-5748-4ed2-b823-943db3cc0759"

# ============================================
# Environment Variables
# ============================================
[vars]
# NOTE: Supabase removed in favor of Cloudflare D1 for module registry
# Legacy Supabase connection retained for existing features (can be removed later)
# SUPABASE_URL = "" (Deprecated)
# SUPABASE_ANON_KEY = "" (Deprecated)

# Voice AI Configuration
VOICE_ENABLED = "true"
VOICE_DEFAULT_PROVIDER = "openai"
OPENAI_VOICE_MODEL = "whisper-1"
OPENAI_TTS_MODEL = "tts-1"
OPENAI_TTS_VOICE = "alloy"
ENABLE_GPT5 = "false"

# ============================================
# ACHEEVY + II-Agent Cloud Run Integration
# ============================================
# Dev default: local hub (override in production env)
ACHEEVY_HUB_URL = "http://localhost:8080"
GCP_PROJECT_ID = "nurds-code-prod"
GCP_REGION = "us-central1"
CLOUDFLARE_WORKER_URL = "https://nurdscode-api.bpo-49d.workers.dev"

# Kie.ai API (Video/Image Generation) - set in `.dev.vars` (local) or via `wrangler secret put KIE_API_KEY`
KIE_API_KEY = ""

# Authentication (Clerk)
CLERK_FRONTEND_API_URL = "https://precise-lamprey-55.clerk.accounts.dev"
CLERK_BACKEND_API_URL = "https://api.clerk.com"
CLERK_JWKS_URL = "https://precise-lamprey-55.clerk.accounts.dev/.well-known/jwks.json"

# Algorand Configuration (testnet)
ALGOD_SERVER = "https://testnet-algorand.api.purestake.io/ps2"
ALGOD_PORT = ""
INDEXER_SERVER = "https://testnet-algorand.api.purestake.io/idx2"

# RBAC
ADMIN_ALLOWLIST = ""
CLERK_ORG_ID_SUPERADMINS = ""
CLERK_SUPERADMIN_ROLE = "owner"

# Stripe (publishable key should also come from env; secret key set via `wrangler secret put STRIPE_SECRET_KEY`)
STRIPE_PUBLISHABLE_KEY = ""
STRIPE_METER_ID = "mk_1SmnFUHW9f80DXRWMWHZ4VRQ"

# AI Gateway (optional)
AI_GATEWAY_ACCOUNT_ID = ""
AI_GATEWAY_GATEWAY_NAME = "nurdscode-gateway"

MAX_REQUESTS_PER_MINUTE = "60"
RESPONSE_TIMEOUT_MS = "30000"

# ============================================
# VibeSDK Whitelabel Configuration
# ============================================
VIBESDK_ENABLED = "true"
SITE_TITLE = "Nurds Code Studio"
SITE_TAGLINE = "Build apps with AI that has seen some things"
ALLOWED_MODELS = '["claude-3-5-sonnet-20241022","gpt-4o","llama-3.3-70b-versatile","gemini-2.0-flash-exp"]'
DEFAULT_MODEL = "claude-3-5-sonnet-20241022"
AGENT_PERSONA = "boomer_ang"
VOICE_INPUT_ENABLED = "true"
TTS_OUTPUT_ENABLED = "true"
STUDIO_SUBDOMAIN = "studio"

# ============================================
# AI Bindings (Cloudflare Workers AI)
# ============================================
[ai]
binding = "AI"

# ============================================
# Compatibility Flags
# ============================================
compatibility_flags = [
  "nodejs_compat",
  "transformstream_enable_standard_constructor",
  "streams_enable_constructors"
]

# ============================================
# Observability
# ============================================
[observability]
enabled = true

# ============================================
# Environment: Production (bindings only for deploy)
# ============================================
[env.production]
name = "nurdscode-api-prod"
route = "api.nurdscode.com/*"

# KV / R2 / Durable Objects / Analytics can be set here for prod only
# [[env.production.kv_namespaces]]
# binding = "CACHE"
# id = "<kv-id>"

# [[env.production.r2_buckets]]
# binding = "ASSETS"
# bucket_name = "nurdscode-assets-prod"

# [[env.production.durable_objects.bindings]]
# name = "CHAT_ROOMS"
# class_name = "ChatRoom"
# script_name = "nurdscode-api-prod"
